function [U,V,P] = DGS(U,V,P,F,G,D,N)
% DGS 磨光子
% 输入初值 U,V,P, 常数项 F,G,D, 网格规模 N
% 输出迭代 1 次的结果 U,V,P
if N~=2
    %% Step 1: G-S 迭代(分量形式)
    U(1,1) = ( F(1,1) + N^2*U(1,2) + N^2*U(2,1) - N* (P(1,2) - P(1,1)))/(3*N^2);
    for j = 2:N-2
        U(1,j) = ( F(1,j) + N^2*U(1,j+1) + N^2*U(2,j) + N^2*U(1,j-1) - N* (P(1,j+1) - P(1,j)))/(3*N^2);
    end
    U(1,N-1) = ( F(1,N-1) + N^2 * U(1,N-2) + N^2*U(2,N-1) - N* (P(1,N) - P(1,N-1)))/(3*N^2);
    for i = 2:N-1
        U(i,1) = ( F(i,1) + N^2*U(i,2) + N^2*U(i+1,1) + N^2*U(i-1,1) - N* (P(i,2) - P(i,1)))/(4*N^2);
        for j=2:N-2
            U(i,j) = ( F(i,j) + N^2*U(i,j+1) + N^2*U(i,j-1) + N^2*U(i+1,j) + N^2*U(i-1,j) - N* (P(i,j+1) - P(i,j)))/(4*N^2);
        end
        U(i,N-1) = ( F(i,N-1) + N^2*U(i,N-2) + N^2*U(i+1,N-1) + N^2*U(i-1,N-1) - N* (P(i,N) - P(i,N-1)))/(4*N^2);
    end
    U(N,1) = ( F(N,1) + N^2*U(N,2) + N^2*U(N-1,1) - N* (P(N,2) - P(N,1)))/(3*N^2);
    for j = 2:N-2
        U(N,j) = ( F(N,j) + N^2*U(N,j+1) + N^2*U(N-1,j) + N^2*U(N,j-1) - N* (P(N,j+1) - P(N,j)))/(3*N^2);
    end
    U(N,N-1) = ( F(N,N-1) + N^2 * U(N,N-2) + N^2*U(N-1,N-1) - N* (P(N,N) - P(N,N-1)))/(3*N^2);
    %
    V(1,1) = ( G(1,1) + N^2*V(2,1) + N^2*V(1,2) - N*( P(2,1)-P(1,1)))/(3*N^2);
    for j=2:N-1
        V(1,j) = ( G(1,j) + N^2*V(2,j) + N^2*V(1,j+1) + N^2*V(1,j-1) - N*( P(2,j)-P(1,j)))/(4*N^2);
    end
    V(1,N) = ( G(1,N) + N^2*V(2,N) + N^2*V(1,N-1) - N*( P(2,N)-P(1,N)))/(3*N^2);
    for i=2:N-2
        V(i,1) = ( G(i,1) + N^2*V(i+1,1) + N^2*V(i,2) + N^2*V(i-1,1) - N*( P(i+1,1)-P(i,1)))/(3*N^2);
        for j=2:N-1
            V(i,j) = ( G(i,j) + N^2*V(i+1,j) + N^2*V(i,j+1) + N^2*V(i-1,j) + N^2*V(i,j-1) - N*( P(i+1,j)-P(i,j)))/(4*N^2);
        end
        V(i,N) = ( G(i,N) + N^2*V(i+1,N) + N^2*V(i,N-1) + N^2*V(i-1,N) - N*( P(i+1,N)-P(i,N)))/(3*N^2);
    end
    V(N-1,1) = ( G(N-1,1) + N^2*V(N-1,2) + N^2*V(N-2,1) - N*( P(N,1)-P(N-1,1)))/(3*N^2);
    for j=2:N-1
        V(N-1,j) = ( G(N-1,j) + N^2*V(N-2,j) + N^2*V(N-1,j+1) + N^2*V(N-1,j-1) - N*( P(N,j)-P(N-1,j)))/(4*N^2);
    end
    V(N-1,N) = ( G(N-1,N) + N^2*V(N-2,N) + N^2*V(N-1,N-1) - N*( P(N,N)-P(N-1,N)))/(3*N^2);

    %% Step 2: 更新
    r = D(1,1) - N*(U(1,1)+V(1,1)); d = r/(2*N); 
    U(1,1)=U(1,1)+d; V(1,1)=V(1,1)+d; P(1,1) = P(1,1) + r; P(1,2) = P(1,2) - r/2; P(2,1) = P(2,1) - r/2;
    for j=2:N-1
        r = D(1,j) - N*(U(1,j)-U(1,j-1)+V(1,j)); d = r/(3*N); 
        U(1,j)=U(1,j)+d; U(1,j-1) = U(1,j-1) - d; V(1,j)=V(1,j)+d; 
        P(1,j) = P(1,j) + r; P(1,j+1) = P(1,j+1) - r/3; P(1,j-1) = P(1,j-1) - r/3; P(2,j) = P(2,j) - r/3;
    end
    r = D(1,N) - N*(-U(1,N-1)+V(1,N)); d = r/(2*N); 
    U(1,N-1)=U(1,N-1)-d; V(1,N)=V(1,N)+d; P(1,N) = P(1,N) + r; P(1,N-1) = P(1,N-1) - r/2; P(2,N) = P(2,N) - r/2;

    for i=2:N-1
        r = D(i,1) - N*(U(i,1)+V(i,1)-V(i-1,1)); d = r/(3*N); 
        U(i,1)=U(i,1)+d; V(i,1)=V(i,1)+d; V(i-1,1)=V(i-1,1)-d; 
        P(i,1) = P(i,1) + r; P(i,2) = P(i,2) - r/3; P(i+1,1) = P(i+1,1) - r/3;  P(i-1,1) = P(i-1,1) - r/3;
        for j=2:N-1
            r = D(i,j) - N*(U(i,j)-U(i,j-1)+V(i,j)-V(i-1,j)); d = r/(4*N);
            U(i,j) = U(i,j) +d; V(i,j)=V(i,j)+d; U(i,j-1)=U(i,j-1)-d; V(i-1,j)= V(i-1,j)-d;
            P(i,j) = P(i,j) + r; P(i,j-1)=P(i,j-1) -r/4; P(i,j+1)=P(i,j+1)-r/4; P(i+1,j)=P(i+1,j)-r/4; P(i-1,j)=P(i-1,j)-r/4;
        end
        r = D(i,N) - N*(-U(i,N-1)+V(i,N)-V(i-1,N)); d = r/(3*N); 
        U(i,N-1)=U(i,N-1)-d; V(i,N)=V(i,N)+d; V(i-1,N)=V(i-1,N)-d; 
        P(i,N) = P(i,N) + r; P(i,N-1) = P(i,N-1) - r/3; P(i+1,N) = P(i+1,N) - r/3;  P(i-1,N) = P(i-1,N) - r/3;
    end

    r = D(N,1) - N*(U(N,1)-V(N-1,1)); d = r/(2*N); 
    U(N,1)=U(N,1)+d; V(N-1,1)=V(N-1,1)-d; P(N,1) = P(N,1) + r; P(N,2) = P(N,2) - r/2; P(N-1,1) = P(N-1,1) - r/2;
    for j=2:N-1
        r = D(N,j) - N*(U(N,j)-U(N,j-1)-V(N-1,j)); d = r/(3*N); 
        U(N,j)=U(N,j)+d; U(N,j-1) = U(N,j-1) - d; V(N-1,j)=V(N-1,j)-d; 
        P(N,j) = P(N,j) + r; P(N,j+1) = P(N,j+1) - r/3; P(N,j-1) = P(N,j-1) - r/3; P(N-1,j) = P(N-1,j) - r/3;
    end
    r = D(N,N) - N*(-U(N,N-1)-V(N-1,N)); d = r/(2*N); 
    U(N,N-1)=U(N,N-1)-d; V(N-1,N)=V(N-1,N)-d; P(N,N) = P(N,N) + r; P(N,N-1) = P(N,N-1) - r/2; P(N-1,N) = P(N-1,N) - r/2;
elseif N==2
    U(1,1) = ( F(1,1) + N^2*U(2,1) - N* (P(1,2) - P(1,1)))/(3*N^2);
    U(2,1) = ( F(2,1) + N^2*U(1,1) - N* (P(2,2) - P(2,1)))/(3*N^2);
    V(1,1) = ( G(1,1) + N^2*V(1,2) - N* (P(2,1) - P(1,1)))/(3*N^2);
    V(1,2) = ( G(1,2) + N^2*V(1,1) - N* (P(2,2) - P(1,2)))/(3*N^2);
    
    r = D(1,1) - N*(U(1,1)+V(1,1)); d = r/(2*N); 
    U(1,1)=U(1,1)+d; V(1,1)=V(1,1)+d; P(1,1) = P(1,1) + r; P(1,2) = P(1,2) - r/2; P(2,1) = P(2,1) - r/2;
    r = D(1,2) - N*(-U(1,1)+V(1,2)); d = r/(2*N); 
    U(1,1)=U(1,1)-d; V(1,2)=V(1,2)+d; P(1,2) = P(1,2) + r; P(1,1) = P(1,1) - r/2; P(2,2) = P(2,2) - r/2;
    r = D(2,1) - N*(U(2,1)-V(1,1)); d = r/(2*N); 
    U(2,1)=U(2,1)+d; V(1,1)=V(1,1)-d; P(2,1) = P(2,1) + r; P(2,2) = P(2,2) - r/2; P(1,1) = P(1,1) - r/2;
    r = D(2,2) - N*(-U(2,1)-V(1,2)); d = r/(2*N); 
    U(2,1)=U(2,1)-d; V(1,2)=V(1,2)-d; P(2,2) = P(2,2) + r; P(1,2) = P(1,2) - r/2; P(2,1) = P(2,1) - r/2;
end